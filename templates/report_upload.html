{% extends 'base.html' %} {% block title %}Upload Reports - Dangote POSM{% endblock %}
{% block head_extra %}
<style>
    .upload-area {
        border: 2px dashed {{ profile.primary_color }};
        border-radius: 8px;
        padding: 30px;
        text-align: center;
        margin-bottom: 20px;
        transition: all 0.3s;
        background-color: #fffdf5;
    }
    
    .upload-area:hover, .upload-area.dragover {
        background-color: #fff8e1;
        border-color: {{ profile.secondary_color or profile.primary_color }};
    }
    
    .upload-icon {
        font-size: 48px;
        color: {{ profile.primary_color }};
        margin-bottom: 15px;
    }
    
    .preview-table {
        max-height: 400px;
        overflow-y: auto;
    }
    
    .preview-controls {
        margin: 20px 0;
    }
    
    .sheet-tab {
        cursor: pointer;
        padding: 8px 15px;
        margin-right: 5px;
        border-radius: 5px 5px 0 0;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-bottom: none;
    }
    
    .sheet-tab.active {
        background-color: #fdcc03;
        color: white;
    }
    
    .mapping-section {
        margin-top: 20px;
        padding: 15px;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        background-color: #f8f9fa;
    }
    
    .mapping-row {
        margin-bottom: 10px;
    }
    
    .status-indicator {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 5px;
    }
    
    .status-valid {
        background-color: #28a745;
    }
    
    .status-invalid {
        background-color: #dc3545;
    }
    
    .status-warning {
        background-color: #ffc107;
    }
    
    /* Mobile optimizations */
    @media (max-width: 767.98px) {
        .upload-area {
            padding: 15px;
        }
        
        .upload-icon {
            font-size: 36px;
        }
        
        .preview-table {
            max-height: 300px;
        }
    }
</style>
{% endblock %} 

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 mb-0">Upload Reports</h1>
        <div>
            <a href="{{ url_for('reports_bp.reports') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i> Back to Reports
            </a>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-12 mb-4">
            <div class="card">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">Upload XLSX Report</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Upload your XLSX report file to import data. The system will preview the data before uploading to the database.
                    </div>
                    
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <h5>Drag & Drop your XLSX file here</h5>
                        <p class="text-muted">or</p>
                        <input type="file" id="fileInput" class="d-none" accept=".xlsx, .xls">
                        <button class="btn btn-primary" id="browseBtn">
                            <i class="fas fa-folder-open me-1"></i> Browse Files
                        </button>
                    </div>
                    
                    <div id="uploadStatus" class="d-none">
                        <div class="progress mb-3">
                            <div id="uploadProgress" class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p id="uploadStatusText" class="mb-0"></p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Preview Section -->
        <div class="col-md-12 mb-4 d-none" id="previewSection">
            <div class="card">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Data Preview</h5>
                    <div>
                        <span class="badge bg-primary me-2" id="rowCount">0 rows</span>
                        <button class="btn btn-sm btn-outline-secondary" id="refreshPreviewBtn">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Sheet tabs -->
                    <div class="d-flex mb-3" id="sheetTabs">
                        <!-- Sheet tabs will be added here -->
                    </div>
                    
                    <!-- Data validation summary -->
                    <div class="alert alert-warning mb-3 d-none" id="validationSummary">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i> Validation Issues</h6>
                        <ul id="validationIssuesList">
                            <!-- Validation issues will be added here -->
                        </ul>
                    </div>
                    
                    <!-- Preview table -->
                    <div class="preview-table table-responsive">
                        <table class="table table-striped table-bordered" id="previewTable">
                            <thead id="previewTableHead">
                                <!-- Table headers will be added here -->
                            </thead>
                            <tbody id="previewTableBody">
                                <!-- Table data will be added here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Column mapping -->
                    <div class="mapping-section d-none" id="mappingSection">
                        <h6 class="mb-3">Column Mapping</h6>
                        <div id="columnMappings">
                            <!-- Column mappings will be added here -->
                        </div>
                    </div>
                    
                    <!-- Preview controls -->
                    <div class="preview-controls d-flex justify-content-between">
                        <button class="btn btn-outline-danger" id="cancelBtn">
                            <i class="fas fa-times me-1"></i> Cancel
                        </button>
                        <div>
                            <button class="btn btn-outline-secondary me-2" id="configureBtn">
                                <i class="fas fa-cog me-1"></i> Configure Mapping
                            </button>
                            <button class="btn btn-success" id="importBtn">
                                <i class="fas fa-database me-1"></i> Import to Database
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Import Results Section -->
        <div class="col-md-12 mb-4 d-none" id="resultsSection">
            <div class="card">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">Import Results</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-success d-none" id="successAlert">
                        <i class="fas fa-check-circle me-2"></i>
                        <span id="successMessage"></span>
                    </div>
                    
                    <div class="alert alert-danger d-none" id="errorAlert">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        <span id="errorMessage"></span>
                    </div>
                    
                    <div id="importSummary">
                        <!-- Import summary will be added here -->
                    </div>
                    
                    <div class="d-flex justify-content-end mt-3">
                        <a href="{{ url_for('reports_bp.reports') }}" class="btn btn-primary">
                            <i class="fas fa-chart-bar me-1"></i> View Reports
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 

{% block scripts %}
<!-- SheetJS library for Excel parsing -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<!-- Report upload script -->
<script src="{{ url_for('static', filename='js/report-upload.js') }}"></script>
{% endblock %}